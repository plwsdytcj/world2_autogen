import * as React from 'react';

console.log('[i18n] Module loading, React:', React);
console.log('[i18n] React.createContext:', React.createContext);
console.log('[i18n] React.useContext:', React.useContext);

export type Lang = 'en' | 'zh' | 'ja';

type Dict = Record<string, string>;

const dicts: Record<Lang, Dict> = {
  en: {
    'app.title': 'world2',
    'nav.projects': 'Projects',
    'nav.credentials': 'Credentials',
    'nav.templates': 'Templates',
    'footer.version': 'Version',

    // Character editor
    'character.title': 'Character Card',
    'character.avatar': 'Avatar',
    'character.suggestions': 'Suggestions from sources',
    'character.name': 'Name',
    'character.description': 'Description',
    'character.persona': 'Persona',
    'character.scenario': 'Scenario',
    'character.firstMessage': 'First Message',
    'character.exampleMessages': 'Example Messages',
    'character.contextSources': 'Context Sources',
    'character.sourcesTip': 'Add source URLs, fetch their content, then select which ones to use for generation.',
    'character.contentFetching': 'Content Fetching',
    'character.lastFetched': 'Last fetched',
    'character.fetched': 'Fetched',
    'character.notFetched': 'Not Fetched',
    'character.tokens': 'tokens',
    'character.viewContent': 'View Content',
    'character.fetchContent': 'Fetch/Re-fetch Content',
    'character.regenTitle': 'Regenerate',
    'character.customPrompt': 'Custom Prompt (Optional)',
    'character.customPromptDesc': 'Provide a specific instruction for the regeneration.',
    'character.customPromptPh': 'e.g., Make it more sarcastic and world-weary.',
    'character.contextSourcesDesc': 'Select which sources of information to provide to the AI as context.',
    'character.includeExisting': 'Include existing character fields',
    'character.includeExistingDesc': 'Uses the other generated fields as context. (Recommended, low token cost)',
    'character.includeFetched': 'Include content from fetched sources',
    'character.includeFetchedDesc': 'Select which sources to use as context. Be mindful of the token count.',
    'character.regenJob': 'Regeneration Job',
    'character.totalTokens': 'Total Estimated Context Tokens',
    'character.regenerate': 'Regenerate',

    // Buttons
    'btn.generate': 'Generate',
    'btn.save': 'Save Changes',
    'btn.exportCard': 'Export Card',
    'btn.exportJson': 'Export JSON',
    'btn.exportMobile': 'Export to Mobile',

    // Export modal
    'export.title': 'Export to Mobile',
    'export.projectId': 'Project ID',
    'export.contentType': 'Content Type',
    'export.format': 'Format',
    'export.generate': 'Generate Link & QR',
    'export.copy': 'Copy Link',
    'export.open': 'Open',
    'export.scan': 'Scan with iOS App',
    'export.deepLink': 'Deep Link (QR content)',
    'export.universal': 'Universal Link',
    'export.scheme': 'URL Scheme (fallback)',
    'export.downloadQr': 'Download QR as image',

    // Common
    'common.cancel': 'Cancel',
    'common.nameId': 'Name / ID',
    'common.name': 'Name',
    'common.status': 'Status',
    'common.lastUpdated': 'Last Updated',
    'common.actions': 'Actions',
    'common.saved': 'Saved',
    'common.savedMsg': 'Your changes have been saved successfully.',
    'common.unsaved': 'You have unsaved changes',
    'common.error': 'Error!',
    'common.show': 'Show',
    'common.hide': 'Hide',

    // Projects (lists + modal + notifications)
    'projects.create': 'Create New Project',
    'projects.loadFailed': 'Failed to load projects',
    'projects.empty': 'No projects found. Create one to get started!',
    'projects.deleteTitle': 'Delete Project',
    'projects.deleteConfirm': 'Are you sure you want to delete this project? This action is irreversible and will delete all associated data.',
    'projects.deleteConfirmBtn': 'Delete Project',
    'projects.createdTitle': 'Project Created',
    'projects.createdMsg': 'The new project has been created successfully.',
    'projects.createFailed': 'Failed to create project',
    'projects.updatedTitle': 'Project Updated',
    'projects.updatedMsg': 'The project has been updated successfully.',
    'projects.updateFailed': 'Failed to update project',
    'projects.deletedTitle': 'Project Deleted',
    'projects.deletedMsg': 'The project has been successfully deleted.',
    'projects.deleteFailed': 'Failed to delete project',
    'projects.edit': 'Edit Project',
    'projects.name': 'Project Name',
    'projects.id': 'Project ID',
    'projects.highPrompt': 'High-level Prompt',
    'projects.lorebookPromptDesc': 'A general prompt describing the overall goal of the lorebook.',
    'projects.characterPromptDesc': 'A prompt describing the character to generate. Be specific about their personality and key traits.',
    'projects.selectCredential': 'Select a credential',
    'projects.modelName': 'Model Name',
    'projects.addCredential': 'Add Credential',

    // Credentials page
    'credentials.create': 'Add New Credential',
    'credentials.loadFailed': 'Failed to load credentials',
    'credentials.empty': 'No credentials found. Create one to get started!',
    'credentials.deleteTitle': 'Delete Credential',
    'credentials.deleteConfirm': 'Are you sure you want to delete this credential? This action is irreversible.',
    'credentials.deleteConfirmBtn': 'Delete Credential',
    'credentials.providerType': 'Provider Type',

    // Credential modal
    'creds.edit': 'Edit Credential',
    'creds.create': 'Create Credential',
    'creds.name': 'Credential Name',
    'creds.providerType': 'Provider Type',
    'creds.selectProvider': 'Select a provider type',
    'creds.baseUrl': 'Base URL',
    'creds.apiKey': 'API Key',
    'creds.testModel': 'Test Model Name',
    'creds.testModelDesc': 'Select or enter a model to use for testing.',
    'creds.selectModel': 'Select a model for testing',
    'creds.refreshModels': 'Refresh model list',
    'creds.jsonTestMode': 'JSON Test Mode',
    'creds.apiNative': 'API Native',
    'creds.promptEng': 'Prompt Engineering',
    'creds.test': 'Test Credential',
    'creds.nameRequired': 'Name is required',
    'creds.providerRequired': 'Provider is required',
    'creds.apiKeyRequired': 'API Key is required',
    'creds.baseUrlRequired': 'Base URL is required',
    'creds.missingModelTitle': 'Missing Model',
    'creds.missingModelMsg': 'Please select a model to run the test.',
    'creds.baseUrlCorrected': 'Base URL Corrected',
    'creds.baseUrlCorrectedMsg': 'The /chat/completions suffix has been removed automatically.',
    'creds.createdTitle': 'Credential Created',
    'creds.createdMsg': 'The new credential has been created successfully.',
    'creds.createFailed': 'Failed to create credential',
    'creds.updatedTitle': 'Credential Updated',
    'creds.updatedMsg': 'The credential has been updated successfully.',
    'creds.updateFailed': 'Failed to update credential',
    'creds.deletedTitle': 'Credential Deleted',
    'creds.deletedMsg': 'The credential has been successfully deleted.',
    'creds.deleteFailed': 'Failed to delete credential',
    'creds.testSuccess': 'Success',
    'creds.testFailed': 'Test Failed',
    'creds.fetchModelsFailed': 'Failed to Fetch Models',

    // Templates page + modal + notifications
    'templates.title': 'Global Templates',
    'templates.create': 'Create New Template',
    'templates.loadFailed': 'Failed to load templates',
    'templates.empty': 'No global templates found. Create one to get started!',
    'templates.deleteTitle': 'Delete Global Template',
    'templates.deleteConfirm': 'Are you sure you want to delete this template? This action is irreversible.',
    'templates.deleteConfirmBtn': 'Delete Template',
    'templates.validId': 'ID must be lowercase letters, numbers, and dashes only',
    'templates.nameRequired': 'Name is required',
    'templates.contentRequired': 'Content cannot be empty',
    'templates.resetDefault': 'Reset to default template',
    'templates.edit': 'Edit Global Template',
    'templates.id': 'Template ID',
    'templates.name': 'Template Name',
    'templates.content': 'Template Content',
    'templates.createdTitle': 'Template Created',
    'templates.createdMsg': 'The new global template has been created successfully.',
    'templates.createFailed': 'Failed to create template',
    'templates.updatedTitle': 'Template Updated',
    'templates.updatedMsg': 'The template has been updated successfully.',
    'templates.updateFailed': 'Failed to update template',
    'templates.deletedTitle': 'Template Deleted',
    'templates.deletedMsg': 'The template has been successfully deleted.',
    'templates.deleteFailed': 'Failed to delete template',

    // Analytics
    'analytics.title': 'Project Analytics',
    'analytics.loadFailed': 'Failed to load analytics',
    'analytics.usageCost': 'Usage & Cost',
    'analytics.totalRequests': 'Total Requests',
    'analytics.totalCost': 'Total Cost',
    'analytics.partialCostTip': 'Total is partial as some requests used models with unknown pricing.',
    'analytics.avgLatency': 'Avg. Latency',
    'analytics.inputTokens': 'Input Tokens',
    'analytics.outputTokens': 'Output Tokens',
    'analytics.projectStatus': 'Project Status',
    'analytics.lorebookEntries': 'Lorebook Entries',
    'analytics.linkStatuses': 'Link Statuses',
    'analytics.jobStatuses': 'Job Statuses',

    // Logs
    'logs.title': 'API Request Logs',
    'logs.loadFailed': 'Failed to load API logs',
    'logs.timestamp': 'Timestamp',
    'logs.model': 'Model',
    'logs.inputTokens': 'Input Tokens',
    'logs.outputTokens': 'Output Tokens',
    'logs.cost': 'Cost ($)',
    'logs.latency': 'Latency (ms)',
    'logs.empty': 'No API requests have been logged for this project.',

    // Sources step + modal + notifications
    'sources.tip': 'Add sources, then select them to discover sub-categories and crawl for links.',
    'sources.deleteTitle': 'Delete Source',
    'sources.deleteConfirm': 'Are you sure you want to delete this source? This is irreversible.',
    'sources.deleteConfirmBtn': 'Delete Source',
    'sources.bulkDeleteTitle': 'Delete Selected Sources',
    'sources.bulkDeleteConfirm': 'Are you sure you want to delete the selected sources? This action is irreversible.',
    'sources.deepCrawlTitle': 'Confirm Deep Crawl',
    'sources.deepCrawlWarn1': 'One or more selected sources has a crawl depth greater than 1 (max is {max}).',
    'sources.deepCrawlWarn2': 'This will recursively discover sub-categories and may cause many API calls and links.',
    'sources.deepCrawlConfirm': 'Are you sure you want to proceed?',
    'sources.startDiscovery': 'Start Discovery',
    'sources.completePrev': 'Complete the previous step to add and manage sources.',
    'sources.add': 'Add New Source',
    'sources.discoverScan': 'Discover & Scan',
    'sources.rescanSelected': 'Rescan Selected',
    'sources.deleteSelected': 'Delete Selected',
    'sources.discoverScanStatus': 'Discover & Scan Job Status',
    'sources.rescanStatus': 'Rescan Job Status',
    'sources.selectAll': 'Select / Deselect All',
    'sources.empty': 'No sources have been added yet.',
    // Modal fields
    'sources.validUrl': 'Please enter a valid URL',
    'sources.edit': 'Edit Source',
    'sources.url': 'Source URL',
    'sources.maxPages': 'Max Pages to Crawl',
    'sources.maxPagesDesc': 'Pagination limit per source. Set to 1 to disable.',
    'sources.maxDepth': 'Max Crawl Depth',
    'sources.maxDepthDesc': 'How many levels of sub-categories to discover.',
    'sources.exclusions': 'URL Exclusion Patterns',
    'sources.exclusionsDesc': 'URLs containing any of these patterns (one per line) will be ignored during crawling.',
    'sources.advanced': 'Advanced: CSS Selectors',
    'sources.contentSelectors': 'Content Link Selectors',
    'sources.contentSelectorsDesc': 'CSS selectors for links to content pages, one per line.',
    'sources.paginationSelector': 'Pagination Link Selector',
    'sources.paginationSelectorDesc': "CSS selector for the 'next page' link.",
    'sources.testSelectors': 'Test Selectors',
    'sources.selectorTestResult': 'Selector Test Result',
    'sources.linksFound': 'Found {count} content links.',
    'sources.paginationFound': 'Pagination link found: {url}',
    'sources.paginationNotFound': 'No pagination link found.',
    'sources.firstLink': 'First link',
    // notifications
    'sources.addedTitle': 'Source Added',
    'sources.addedMsg': 'The new source has been added successfully.',
    'sources.addFailed': 'Failed to add source',
    'sources.updatedTitle': 'Source Updated',
    'sources.updatedMsg': 'The source has been updated successfully.',
    'sources.updateFailed': 'Failed to update source',
    'sources.deletedTitle': 'Source Deleted',
    'sources.deletedMsg': 'The source has been successfully deleted.',
    'sources.deleteFailed': 'Failed to delete source',
    'sources.bulkDeletedTitle': 'Sources Deleted',
    'sources.bulkDeletedMsg': '{n} sources have been successfully deleted.',
    'sources.bulkDeleteFailed': 'Failed to delete sources',

    // Confirm Links
    'confirmLinks.desc': 'Confirm Links',
    'confirmLinks.completePrev': 'Complete the previous steps to review links.',
    'confirmLinks.found': 'Found {count} new links. Review and uncheck any to exclude, then save.',
    'confirmLinks.noneFound': 'No new links found. All discovered links are already saved to the project.',
    'confirmLinks.newLinksFound': 'New Links Found ({sel} / {total} selected)',
    'confirmLinks.selectAllNew': 'Select / Deselect All New',
    'confirmLinks.filterPlaceholder': 'Filter links...',
    'confirmLinks.saved': 'Saved',
    'confirmLinks.showExisting': 'Show {count} already saved links',
    'confirmLinks.previewTitle': 'Link Preview',
    'confirmLinks.hoverHint': 'Hover over a link to preview it here',
    'confirmLinks.saving': 'Saving...',
    'confirmLinks.confirmAndSave': 'Confirm and Save {count} New Links',
    'confirmLinks.statusTitle': 'Link Confirmation Job Status',
    'confirmLinks.nonePending': 'No new links to confirm. Proceed to the next step to manage and process your saved links.',

    // Search Params step
    'searchParams.stepDesc': 'Search Params',
    'searchParams.tip': 'Use AI to analyze your prompt and generate structured search parameters.',
    'searchParams.promptLabel': 'Your high-level prompt',
    'searchParams.promptPh': "e.g., 'All major and minor locations in Skyrim'",
    'searchParams.generating': 'Generating...',
    'searchParams.regen': 'Re-generate Parameters',
    'searchParams.generate': 'Generate Search Parameters',
    'searchParams.statusTitle': 'Generation Job Status',
    'searchParams.generatedPurpose': 'Generated Purpose',
    'searchParams.generatedNotes': 'Generated Extraction Notes',
    'searchParams.generatedCriteria': 'Generated Criteria',

    // Entries / processing
    'entries.stepDesc': 'Generate Entries',
    'entries.addManualTitle': 'Add Manual Links',
    'entries.linksLabel': 'Links',
    'entries.linksDesc': 'Enter one URL per line.',
    'entries.addNLinks': 'Add {n} Links',
    'entries.noneToProcessTitle': 'No Links to Process',
    'entries.noneToProcessMsg': 'All links for this project have already been processed.',
    'entries.confirmGenTitle': 'Confirm Generation',
    'entries.confirmGenMsg1': 'You are about to process {n} pending or failed links.',
    'entries.confirmGenMsg2': 'This will make up to {n} API calls to the {model} model.',
    'entries.startGen': 'Start Generation',
    'entries.deleteSelectedTitle': 'Delete Selected Links',
    'entries.deleteSelectedMsg': 'Are you sure you want to delete the {n} selected links?',
    'entries.deleteLinks': 'Delete Links',
    'entries.reprocessTitle': 'Reprocess Selected Links',
    'entries.reprocessMsg': 'You are about to reprocess {n} selected links.',
    'entries.reprocess': 'Reprocess',
    'entries.completePrev': 'Complete the previous steps to generate entries.',
    'entries.tip': 'Manage links below. Start a job to process all pending/failed links, or select specific ones to reprocess or delete.',
    'entries.startAll': 'Start Generation for All',
    'entries.reprocessSel': 'Reprocess Selected',
    'entries.deleteSel': 'Delete Selected',
    'entries.addManual': 'Add Manual Links',
    'entries.statusTitle': 'Main Generation Job Status',
    'entries.linkUrl': 'Link URL',
    'entries.linksDeletedTitle': 'Links Deleted',
    'entries.linksDeletedMsg': '{n} links have been successfully deleted.',
    'entries.deleteFailed': 'Failed to delete links',

    // Jobs SSE
    'jobs.statusTitle': 'Job',
    'jobs.finished': 'The job has finished with status',

    // Steps overview (ProjectDetailPage)
    'completed.stepDesc': 'Review & Download',
  },
  zh: {
    'app.title': 'world2',
    'nav.projects': '项目',
    'nav.credentials': '凭证',
    'nav.templates': '模板',
    'footer.version': '版本',

    'character.title': '角色卡',
    'character.avatar': '头像',
    'character.suggestions': '来源建议',
    'character.name': '名称',
    'character.description': '描述',
    'character.persona': '人设',
    'character.scenario': '场景',
    'character.firstMessage': '首次消息',
    'character.exampleMessages': '示例消息',
    'character.contextSources': '上下文来源',
    'character.sourcesTip': '添加来源 URL、抓取其内容，然后选择用于生成的来源。',
    'character.contentFetching': '内容抓取',
    'character.lastFetched': '上次抓取',
    'character.fetched': '已抓取',
    'character.notFetched': '未抓取',
    'character.tokens': 'tokens',
    'character.viewContent': '查看内容',
    'character.fetchContent': '抓取/重新抓取',
    'character.regenTitle': '重新生成',
    'character.customPrompt': '自定义提示（可选）',
    'character.customPromptDesc': '为本次重新生成提供具体指令。',
    'character.customPromptPh': '例如：更尖刻、更丧气一些',
    'character.contextSourcesDesc': '选择作为上下文提供给 AI 的来源。',
    'character.includeExisting': '包含已生成的角色字段',
    'character.includeExistingDesc': '将其它已生成字段作为上下文（推荐，代价低）',
    'character.includeFetched': '包含已抓取来源的内容',
    'character.includeFetchedDesc': '选择哪些来源作为上下文，注意 Token 数。',
    'character.regenJob': '重新生成任务',
    'character.totalTokens': '预计上下文 Token 总数',
    'character.regenerate': '重新生成',

    'btn.generate': '生成',
    'btn.save': '保存修改',
    'btn.exportCard': '导出卡片',
    'btn.exportJson': '导出 JSON',
    'btn.exportMobile': '导出到移动端',

    'export.title': '导出到移动端',
    'export.projectId': '项目 ID',
    'export.contentType': '内容类型',
    'export.format': '格式',
    'export.generate': '生成链接与二维码',
    'export.copy': '复制链接',
    'export.open': '打开',
    'export.scan': '使用 iOS App 扫码',
    'export.deepLink': '深链（二维码内容）',
    'export.universal': '通用链接',
    'export.scheme': 'URL Scheme（备用）',
    'export.downloadQr': '下载二维码',

    'common.cancel': '取消',
    'common.nameId': '名称 / ID',
    'common.name': '名称',
    'common.status': '状态',
    'common.lastUpdated': '最近更新',
    'common.actions': '操作',
    'common.saved': '已保存',
    'common.savedMsg': '修改已成功保存。',
    'common.unsaved': '你有未保存的修改',
    'common.error': '错误！',
    'common.show': '展开',
    'common.hide': '收起',

    'projects.create': '新建项目',
    'projects.loadFailed': '加载项目失败',
    'projects.empty': '还没有项目，先创建一个吧！',
    'projects.deleteTitle': '删除项目',
    'projects.deleteConfirm': '确定要删除该项目吗？此操作不可撤销，并会删除所有相关数据。',
    'projects.deleteConfirmBtn': '删除项目',
    'projects.createdTitle': '项目已创建',
    'projects.createdMsg': '新项目已创建成功。',
    'projects.createFailed': '创建项目失败',
    'projects.updatedTitle': '项目已更新',
    'projects.updatedMsg': '项目已成功更新。',
    'projects.updateFailed': '更新项目失败',
    'projects.deletedTitle': '项目已删除',
    'projects.deletedMsg': '该项目已成功删除。',
    'projects.deleteFailed': '删除项目失败',
    'projects.edit': '编辑项目',
    'projects.name': '项目名称',
    'projects.id': '项目 ID',
    'projects.highPrompt': '高阶提示',
    'projects.lorebookPromptDesc': '对 Lorebook 目标的总体描述。',
    'projects.characterPromptDesc': '对要生成的角色进行描述，最好包含其性格与关键特征。',
    'projects.selectCredential': '选择凭证',
    'projects.modelName': '模型名称',
    'projects.addCredential': '新增凭证',

    'credentials.create': '新增凭证',
    'credentials.loadFailed': '加载凭证失败',
    'credentials.empty': '还没有凭证，先新增一个吧！',
    'credentials.deleteTitle': '删除凭证',
    'credentials.deleteConfirm': '确定要删除该凭证吗？此操作不可撤销。',
    'credentials.deleteConfirmBtn': '删除凭证',
    'credentials.providerType': '提供方类型',

    // Credential modal
    'creds.edit': '编辑凭证',
    'creds.create': '创建凭证',
    'creds.name': '凭证名称',
    'creds.providerType': '提供方类型',
    'creds.selectProvider': '选择提供方',
    'creds.baseUrl': 'Base URL',
    'creds.apiKey': 'API Key',
    'creds.testModel': '测试模型名',
    'creds.testModelDesc': '选择或输入一个模型用于测试。',
    'creds.selectModel': '选择一个用于测试的模型',
    'creds.refreshModels': '刷新模型列表',
    'creds.jsonTestMode': 'JSON 测试模式',
    'creds.apiNative': 'API 模式',
    'creds.promptEng': '提示工程',
    'creds.test': '测试凭证',
    'creds.nameRequired': '名称必填',
    'creds.providerRequired': '提供方必选',
    'creds.apiKeyRequired': 'API Key 必填',
    'creds.baseUrlRequired': 'Base URL 必填',
    'creds.missingModelTitle': '缺少模型',
    'creds.missingModelMsg': '请选择一个模型进行测试。',
    'creds.baseUrlCorrected': 'Base URL 已更正',
    'creds.baseUrlCorrectedMsg': '已自动移除 /chat/completions 后缀。',
    'creds.createdTitle': '凭证已创建',
    'creds.createdMsg': '新凭证已创建成功。',
    'creds.createFailed': '创建凭证失败',
    'creds.updatedTitle': '凭证已更新',
    'creds.updatedMsg': '凭证已成功更新。',
    'creds.updateFailed': '更新凭证失败',
    'creds.deletedTitle': '凭证已删除',
    'creds.deletedMsg': '该凭证已成功删除。',
    'creds.deleteFailed': '删除凭证失败',
    'creds.testSuccess': '测试成功',
    'creds.testFailed': '测试失败',
    'creds.fetchModelsFailed': '获取模型失败',

    'templates.title': '全局模板',
    'templates.create': '创建新模板',
    'templates.loadFailed': '加载模板失败',
    'templates.empty': '还没有模板，先创建一个吧！',
    'templates.deleteTitle': '删除全局模板',
    'templates.deleteConfirm': '确定要删除该模板吗？此操作不可撤销。',
    'templates.deleteConfirmBtn': '删除模板',
    'templates.validId': 'ID 只能包含小写字母、数字和连字符',
    'templates.nameRequired': '模板名称必填',
    'templates.contentRequired': '模板内容不能为空',
    'templates.resetDefault': '重置为默认模板',
    'templates.edit': '编辑全局模板',
    'templates.id': '模板 ID',
    'templates.name': '模板名称',
    'templates.content': '模板内容',
    'templates.createdTitle': '模板已创建',
    'templates.createdMsg': '新模板已创建成功。',
    'templates.createFailed': '创建模板失败',
    'templates.updatedTitle': '模板已更新',
    'templates.updatedMsg': '模板已成功更新。',
    'templates.updateFailed': '更新模板失败',
    'templates.deletedTitle': '模板已删除',
    'templates.deletedMsg': '该模板已成功删除。',
    'templates.deleteFailed': '删除模板失败',

    'analytics.title': '项目分析',
    'analytics.loadFailed': '加载分析失败',
    'analytics.usageCost': '用量与费用',
    'analytics.totalRequests': '请求总数',
    'analytics.totalCost': '总费用',
    'analytics.partialCostTip': '部分请求使用了未知定价的模型，因此费用为估算值。',
    'analytics.avgLatency': '平均延迟',
    'analytics.inputTokens': '输入 Token',
    'analytics.outputTokens': '输出 Token',
    'analytics.projectStatus': '项目状态',
    'analytics.lorebookEntries': 'Lorebook 条目数',
    'analytics.linkStatuses': '链接状态',
    'analytics.jobStatuses': '任务状态',

    'logs.title': 'API 请求日志',
    'logs.loadFailed': '加载日志失败',
    'logs.timestamp': '时间',
    'logs.model': '模型',
    'logs.inputTokens': '输入 Token',
    'logs.outputTokens': '输出 Token',
    'logs.cost': '费用（$）',
    'logs.latency': '延迟（毫秒）',
    'logs.empty': '该项目尚无 API 请求记录。',

    'sources.tip': '添加来源后，选择它们以发现子分类并抓取链接。',
    'sources.deleteTitle': '删除来源',
    'sources.deleteConfirm': '确定要删除该来源吗？此操作不可撤销。',
    'sources.deleteConfirmBtn': '删除来源',
    'sources.bulkDeleteTitle': '删除已选来源',
    'sources.bulkDeleteConfirm': '确定要删除已选择的来源吗？此操作不可撤销。',
    'sources.deepCrawlTitle': '确认深度抓取',
    'sources.deepCrawlWarn1': '所选来源中存在抓取深度大于 1 的项（最大为 {max}）。',
    'sources.deepCrawlWarn2': '将递归发现子分类，可能产生较多 API 请求并找到大量链接。',
    'sources.deepCrawlConfirm': '确定要继续吗？',
    'sources.startDiscovery': '开始发现',
    'sources.completePrev': '请先完成上一步以添加并管理来源。',
    'sources.add': '新增来源',
    'sources.discoverScan': '发现并扫描',
    'sources.rescanSelected': '重新扫描所选',
    'sources.deleteSelected': '删除所选',
    'sources.discoverScanStatus': '发现与扫描任务状态',
    'sources.rescanStatus': '重新扫描任务状态',
    'sources.selectAll': '全选 / 取消全选',
    'sources.empty': '尚未添加任何来源。',
    'sources.validUrl': '请输入有效的 URL',
    'sources.edit': '编辑来源',
    'sources.url': '来源 URL',
    'sources.maxPages': '最大分页页数',
    'sources.maxPagesDesc': '每个来源的分页限制；设为 1 表示不分页。',
    'sources.maxDepth': '最大抓取深度',
    'sources.maxDepthDesc': '向下发现子分类的层数。',
    'sources.exclusions': 'URL 排除规则',
    'sources.exclusionsDesc': '包含任一规则的 URL 会被忽略（每行一个）。',
    'sources.advanced': '高级：CSS 选择器',
    'sources.contentSelectors': '内容链接选择器',
    'sources.contentSelectorsDesc': '用于选择内容页链接的 CSS 选择器（每行一个）。',
    'sources.paginationSelector': '分页链接选择器',
    'sources.paginationSelectorDesc': '用于选择"下一页"链接的 CSS 选择器。',
    'sources.testSelectors': '测试选择器',
    'sources.selectorTestResult': '选择器测试结果',
    'sources.linksFound': '找到 {count} 条内容链接。',
    'sources.paginationFound': '找到分页链接：{url}',
    'sources.paginationNotFound': '未找到分页链接。',
    'sources.firstLink': '首条链接',
    'sources.addedTitle': '来源已添加',
    'sources.addedMsg': '新的来源已成功添加。',
    'sources.addFailed': '添加来源失败',
    'sources.updatedTitle': '来源已更新',
    'sources.updatedMsg': '来源已成功更新。',
    'sources.updateFailed': '更新来源失败',
    'sources.deletedTitle': '来源已删除',
    'sources.deletedMsg': '该来源已成功删除。',
    'sources.deleteFailed': '删除来源失败',
    'sources.bulkDeletedTitle': '已删除来源',
    'sources.bulkDeletedMsg': '已成功删除 {n} 个来源。',
    'sources.bulkDeleteFailed': '批量删除来源失败',

    'confirmLinks.desc': '确认链接',
    'confirmLinks.completePrev': '请先完成前面的步骤以审核链接。',
    'confirmLinks.found': '发现 {count} 条新链接。请检查列表，取消不需要的项，然后保存。',
    'confirmLinks.noneFound': '未发现新的链接，所有已发现的链接都已保存到项目。',
    'confirmLinks.newLinksFound': '发现新链接（已选 {sel} / 共 {total}）',
    'confirmLinks.selectAllNew': '全选 / 取消全选（新链接）',
    'confirmLinks.filterPlaceholder': '过滤链接…',
    'confirmLinks.saved': '已保存',
    'confirmLinks.showExisting': '显示已保存的 {count} 条链接',
    'confirmLinks.previewTitle': '链接预览',
    'confirmLinks.hoverHint': '将鼠标悬停在链接上以在此预览',
    'confirmLinks.saving': '保存中…',
    'confirmLinks.confirmAndSave': '确认并保存 {count} 条新链接',
    'confirmLinks.statusTitle': '链接确认任务状态',
    'confirmLinks.nonePending': '没有待确认的新链接。继续下一步以管理并处理已保存的链接。',

    'searchParams.stepDesc': '检索参数',
    'searchParams.tip': '使用 AI 分析你的提示，自动生成结构化的检索参数（可手动编辑）。',
    'searchParams.promptLabel': '你的高阶提示',
    'searchParams.promptPh': "例如：'天际所有主/次要地点'",
    'searchParams.generating': '正在生成…',
    'searchParams.regen': '重新生成参数',
    'searchParams.generate': '生成检索参数',
    'searchParams.statusTitle': '生成任务状态',
    'searchParams.generatedPurpose': '生成的目的',
    'searchParams.generatedNotes': '生成的提取说明',
    'searchParams.generatedCriteria': '生成的筛选标准',

    'entries.stepDesc': '生成条目',
    'entries.addManualTitle': '手动添加链接',
    'entries.linksLabel': '链接',
    'entries.linksDesc': '每行一个 URL。',
    'entries.addNLinks': '添加 {n} 条链接',
    'entries.noneToProcessTitle': '没有可处理的链接',
    'entries.noneToProcessMsg': '该项目的所有链接都已处理完成。',
    'entries.confirmGenTitle': '确认生成',
    'entries.confirmGenMsg1': '即将处理 {n} 条"待处理/失败"的链接。',
    'entries.confirmGenMsg2': '这将对 {model} 模型发起至多 {n} 次调用。',
    'entries.startGen': '开始生成',
    'entries.deleteSelectedTitle': '删除已选链接',
    'entries.deleteSelectedMsg': '确定要删除已选择的 {n} 条链接吗？',
    'entries.deleteLinks': '删除链接',
    'entries.reprocessTitle': '重处理已选链接',
    'entries.reprocessMsg': '即将重处理 {n} 条已选择的链接。',
    'entries.reprocess': '重处理',
    'entries.completePrev': '请先完成前置步骤以生成条目。',
    'entries.tip': '在下方管理链接：可处理全部"待处理/失败"的链接，或仅对选中的链接进行重处理或删除。',
    'entries.startAll': '处理全部',
    'entries.reprocessSel': '重处理所选',
    'entries.deleteSel': '删除所选',
    'entries.addManual': '手动添加链接',
    'entries.statusTitle': '主生成任务状态',
    'entries.linkUrl': '链接 URL',
    'entries.linksDeletedTitle': '链接已删除',
    'entries.linksDeletedMsg': '已成功删除 {n} 条链接。',
    'entries.deleteFailed': '删除链接失败',

    'jobs.statusTitle': '任务',
    'jobs.finished': '任务已完成，状态为',

    'completed.stepDesc': '复查与下载',
  },
  ja: {
    'app.title': 'world2',
    'nav.projects': 'プロジェクト',
    'nav.credentials': 'クレデンシャル',
    'nav.templates': 'テンプレート',
    'footer.version': 'バージョン',

    'character.title': 'キャラクターカード',
    'character.avatar': 'アバター',
    'character.suggestions': 'ソースからの候補',
    'character.name': '名前',
    'character.description': '説明',
    'character.persona': '性格',
    'character.scenario': 'シナリオ',
    'character.firstMessage': '最初のメッセージ',
    'character.exampleMessages': '例メッセージ',
    'character.contextSources': 'コンテキストソース',
    'character.sourcesTip': 'ソースURLを追加して内容を取得し、生成に使うソースを選択します。',
    'character.contentFetching': 'コンテンツ取得',
    'character.lastFetched': '最終取得',
    'character.fetched': '取得済み',
    'character.notFetched': '未取得',
    'character.tokens': 'トークン',
    'character.viewContent': '内容を表示',
    'character.fetchContent': '取得/再取得',
    'character.regenTitle': '再生成',
    'character.customPrompt': 'カスタムプロンプト（任意）',
    'character.customPromptDesc': '今回の再生成に関する具体的な指示。',
    'character.customPromptPh': '例: もっと皮肉っぽく、やさぐれた感じに',
    'character.contextSourcesDesc': 'AI にコンテキストとして提供するソースを選択します。',
    'character.includeExisting': '既存のキャラクターフィールドを含める',
    'character.includeExistingDesc': '他の生成済みフィールドをコンテキストとして使用（推奨・低コスト）',
    'character.includeFetched': '取得済みソースの内容を含める',
    'character.includeFetchedDesc': 'コンテキストに使用するソースを選択してください。トークン数に注意。',
    'character.regenJob': '再生成ジョブ',
    'character.totalTokens': '推定コンテキストトークン合計',
    'character.regenerate': '再生成',

    'btn.generate': '生成',
    'btn.save': '変更を保存',
    'btn.exportCard': 'カードをエクスポート',
    'btn.exportJson': 'JSON をエクスポート',
    'btn.exportMobile': 'モバイルへエクスポート',

    'export.title': 'モバイルへエクスポート',
    'export.projectId': 'プロジェクトID',
    'export.contentType': 'コンテンツ種別',
    'export.format': '形式',
    'export.generate': 'リンクとQRを生成',
    'export.copy': 'リンクをコピー',
    'export.open': '開く',
    'export.scan': 'iOSアプリでスキャン',
    'export.deepLink': 'ディープリンク（QR内容）',
    'export.universal': 'ユニバーサルリンク',
    'export.scheme': 'URLスキーム（フォールバック）',
    'export.downloadQr': 'QR画像を保存',

    'common.cancel': 'キャンセル',
    'common.nameId': '名称 / ID',
    'common.name': '名称',
    'common.status': 'ステータス',
    'common.lastUpdated': '最終更新',
    'common.actions': '操作',
    'common.saved': '保存しました',
    'common.savedMsg': '変更は正常に保存されました。',
    'common.unsaved': '未保存の変更があります',
    'common.error': 'エラー！',
    'common.show': '展開',
    'common.hide': '折りたたむ',

    'projects.create': '新規プロジェクト',
    'projects.loadFailed': 'プロジェクトの読み込みに失敗しました',
    'projects.empty': 'プロジェクトがありません。まずは作成しましょう！',
    'projects.deleteTitle': 'プロジェクトを削除',
    'projects.deleteConfirm': 'このプロジェクトを削除しますか？この操作は取り消せません。関連データも削除されます。',
    'projects.deleteConfirmBtn': 'プロジェクトを削除',
    'projects.createdTitle': 'プロジェクトを作成しました',
    'projects.createdMsg': '新しいプロジェクトが正常に作成されました。',
    'projects.createFailed': 'プロジェクトの作成に失敗しました',
    'projects.updatedTitle': 'プロジェクトを更新しました',
    'projects.updatedMsg': 'プロジェクトは正常に更新されました。',
    'projects.updateFailed': 'プロジェクトの更新に失敗しました',
    'projects.deletedTitle': 'プロジェクトを削除しました',
    'projects.deletedMsg': 'プロジェクトは正常に削除されました。',
    'projects.deleteFailed': 'プロジェクトの削除に失敗しました',
    'projects.edit': 'プロジェクトを編集',
    'projects.name': 'プロジェクト名',
    'projects.id': 'プロジェクト ID',
    'projects.highPrompt': 'ハイレベルのプロンプト',
    'projects.lorebookPromptDesc': 'Lorebook の目的を示す全体的な説明です。',
    'projects.characterPromptDesc': '生成するキャラクターの説明。性格や特徴を具体的に。',
    'projects.selectCredential': 'クレデンシャルを選択',
    'projects.modelName': 'モデル名',
    'projects.addCredential': 'クレデンシャルを追加',

    'credentials.create': '認証情報を追加',
    'credentials.loadFailed': '認証情報の読み込みに失敗しました',
    'credentials.empty': '認証情報がありません。まずは追加しましょう！',
    'credentials.deleteTitle': '認証情報を削除',
    'credentials.deleteConfirm': 'この認証情報を削除しますか？この操作は取り消せません。',
    'credentials.deleteConfirmBtn': '認証情報を削除',
    'credentials.providerType': 'プロバイダータイプ',

    'creds.edit': '認証情報を編集',
    'creds.create': '認証情報を作成',
    'creds.name': '認証情報名',
    'creds.providerType': 'プロバイダータイプ',
    'creds.selectProvider': 'プロバイダーを選択',
    'creds.baseUrl': 'Base URL',
    'creds.apiKey': 'API Key',
    'creds.testModel': 'テスト用モデル名',
    'creds.testModelDesc': 'テストに使用するモデルを選択または入力します。',
    'creds.selectModel': 'テスト用モデルを選択',
    'creds.refreshModels': 'モデル一覧を更新',
    'creds.jsonTestMode': 'JSON テストモード',
    'creds.apiNative': 'API ネイティブ',
    'creds.promptEng': 'プロンプトエンジニアリング',
    'creds.test': '認証情報をテスト',
    'creds.nameRequired': '名前は必須です',
    'creds.providerRequired': 'プロバイダーは必須です',
    'creds.apiKeyRequired': 'API Key は必須です',
    'creds.baseUrlRequired': 'Base URL は必須です',
    'creds.missingModelTitle': 'モデル未選択',
    'creds.missingModelMsg': 'テストに使用するモデルを選択してください。',
    'creds.baseUrlCorrected': 'Base URL を修正しました',
    'creds.baseUrlCorrectedMsg': '/chat/completions の末尾を自動的に削除しました。',
    'creds.createdTitle': '認証情報を作成しました',
    'creds.createdMsg': '新しい認証情報が正常に作成されました。',
    'creds.createFailed': '認証情報の作成に失敗しました',
    'creds.updatedTitle': '認証情報を更新しました',
    'creds.updatedMsg': '認証情報は正常に更新されました。',
    'creds.updateFailed': '認証情報の更新に失敗しました',
    'creds.deletedTitle': '認証情報を削除しました',
    'creds.deletedMsg': '認証情報は正常に削除されました。',
    'creds.deleteFailed': '認証情報の削除に失敗しました',
    'creds.testSuccess': '成功',
    'creds.testFailed': 'テストに失敗しました',
    'creds.fetchModelsFailed': 'モデルの取得に失敗しました',

    'templates.title': 'グローバルテンプレート',
    'templates.create': '新規テンプレート',
    'templates.loadFailed': 'テンプレートの読み込みに失敗しました',
    'templates.empty': 'テンプレートがありません。まずは作成しましょう！',
    'templates.deleteTitle': 'グローバルテンプレートを削除',
    'templates.deleteConfirm': 'このテンプレートを削除しますか？この操作は取り消せません。',
    'templates.deleteConfirmBtn': 'テンプレートを削除',
    'templates.validId': 'IDは小文字・数字・ハイフンのみ使用できます',
    'templates.nameRequired': '名前は必須です',
    'templates.contentRequired': '内容を入力してください',
    'templates.resetDefault': 'デフォルトにリセット',
    'templates.edit': 'グローバルテンプレートを編集',
    'templates.id': 'テンプレート ID',
    'templates.name': 'テンプレート名',
    'templates.content': 'テンプレート内容',
    'templates.createdTitle': 'テンプレートを作成しました',
    'templates.createdMsg': '新しいテンプレートが正常に作成されました。',
    'templates.createFailed': 'テンプレートの作成に失敗しました',
    'templates.updatedTitle': 'テンプレートを更新しました',
    'templates.updatedMsg': 'テンプレートは正常に更新されました。',
    'templates.updateFailed': 'テンプレートの更新に失敗しました',
    'templates.deletedTitle': 'テンプレートを削除しました',
    'templates.deletedMsg': 'テンプレートは正常に削除されました。',
    'templates.deleteFailed': 'テンプレートの削除に失敗しました',

    'analytics.title': 'プロジェクト分析',
    'analytics.loadFailed': '分析の読み込みに失敗しました',
    'analytics.usageCost': '利用状況とコスト',
    'analytics.totalRequests': '総リクエスト数',
    'analytics.totalCost': '総コスト',
    'analytics.partialCostTip': '一部のリクエストは価格不明のモデルを使用しているため、合計は概算です。',
    'analytics.avgLatency': '平均レイテンシ',
    'analytics.inputTokens': '入力トークン',
    'analytics.outputTokens': '出力トークン',
    'analytics.projectStatus': 'プロジェクトのステータス',
    'analytics.lorebookEntries': 'Lorebook エントリ数',
    'analytics.linkStatuses': 'リンクのステータス',
    'analytics.jobStatuses': 'ジョブのステータス',

    'logs.title': 'API リクエストログ',
    'logs.loadFailed': 'ログの読み込みに失敗しました',
    'logs.timestamp': 'タイムスタンプ',
    'logs.model': 'モデル',
    'logs.inputTokens': '入力トークン',
    'logs.outputTokens': '出力トークン',
    'logs.cost': 'コスト（$）',
    'logs.latency': 'レイテンシ（ms）',
    'logs.empty': 'このプロジェクトにはログがまだありません。',

    'sources.tip': 'ソースを追加し、選択してサブカテゴリの探索とリンクのクロールを行います。',
    'sources.deleteTitle': 'ソースを削除',
    'sources.deleteConfirm': 'このソースを削除しますか？この操作は取り消せません。',
    'sources.deleteConfirmBtn': 'ソースを削除',
    'sources.bulkDeleteTitle': '選択したソースを削除',
    'sources.bulkDeleteConfirm': '選択したソースを削除しますか？この操作は取り消せません。',
    'sources.deepCrawlTitle': 'ディープクロールの確認',
    'sources.deepCrawlWarn1': '選択したソースの中に深さが 1 を超えるものがあります（最大 {max}）。',
    'sources.deepCrawlWarn2': 'サブカテゴリを再帰的に探索し、多くの API コールとリンクが発生する可能性があります。',
    'sources.deepCrawlConfirm': '続行しますか？',
    'sources.startDiscovery': '探索を開始',
    'sources.completePrev': '前のステップを完了してソースを追加・管理してください。',
    'sources.add': 'ソースを追加',
    'sources.discoverScan': '探索とスキャン',
    'sources.rescanSelected': '選択を再スキャン',
    'sources.deleteSelected': '選択を削除',
    'sources.discoverScanStatus': '探索とスキャンのステータス',
    'sources.rescanStatus': '再スキャンのステータス',
    'sources.selectAll': '全選択 / 全解除',
    'sources.empty': 'まだソースが追加されていません。',
    'sources.validUrl': '有効なURLを入力してください',
    'sources.edit': 'ソースを編集',
    'sources.url': 'ソースURL',
    'sources.maxPages': '最大ページ数',
    'sources.maxPagesDesc': '各ソースのページネーション上限。1で無効化。',
    'sources.maxDepth': '最大クロール深度',
    'sources.maxDepthDesc': 'サブカテゴリを探索する階層数。',
    'sources.exclusions': 'URL 除外ルール',
    'sources.exclusionsDesc': 'いずれかを含むURLは除外（1行に1つ）。',
    'sources.advanced': '上級: CSSセレクタ',
    'sources.contentSelectors': 'コンテンツリンクのセレクタ',
    'sources.contentSelectorsDesc': 'コンテンツページのリンクを選択するCSSセレクタ（1行に1つ）。',
    'sources.paginationSelector': 'ページネーションのセレクタ',
    'sources.paginationSelectorDesc': '「次のページ」リンクのCSSセレクタ。',
    'sources.testSelectors': 'セレクタをテスト',
    'sources.selectorTestResult': 'セレクタテスト結果',
    'sources.linksFound': '{count}件のコンテンツリンクを検出しました。',
    'sources.paginationFound': 'ページネーションリンク: {url}',
    'sources.paginationNotFound': 'ページネーションリンクが見つかりません。',
    'sources.firstLink': '最初のリンク',
    'sources.addedTitle': 'ソースを追加しました',
    'sources.addedMsg': '新しいソースが正常に追加されました。',
    'sources.addFailed': 'ソースの追加に失敗しました',
    'sources.updatedTitle': 'ソースを更新しました',
    'sources.updatedMsg': 'ソースは正常に更新されました。',
    'sources.updateFailed': 'ソースの更新に失敗しました',
    'sources.deletedTitle': 'ソースを削除しました',
    'sources.deletedMsg': 'ソースは正常に削除されました。',
    'sources.deleteFailed': 'ソースの削除に失敗しました',
    'sources.bulkDeletedTitle': 'ソースを削除しました',
    'sources.bulkDeletedMsg': '{n} 個のソースを削除しました。',
    'sources.bulkDeleteFailed': 'ソースの一括削除に失敗しました',

    'confirmLinks.desc': 'リンク確認',
    'confirmLinks.completePrev': '前のステップを完了してリンクを確認してください。',
    'confirmLinks.found': '{count}件の新しいリンクが見つかりました。不要なものを外して保存してください。',
    'confirmLinks.noneFound': '新しいリンクはありません。発見済みのリンクはすでに保存されています。',
    'confirmLinks.newLinksFound': '新規リンク（選択 {sel} / 合計 {total}）',
    'confirmLinks.selectAllNew': '新規を全選択 / 全解除',
    'confirmLinks.filterPlaceholder': 'リンクを絞り込み…',
    'confirmLinks.saved': '保存済み',
    'confirmLinks.showExisting': '{count}件の保存済みリンクを表示',
    'confirmLinks.previewTitle': 'リンクプレビュー',
    'confirmLinks.hoverHint': 'リンクにホバーするとここにプレビューされます',
    'confirmLinks.saving': '保存中…',
    'confirmLinks.confirmAndSave': '{count}件の新規リンクを確認して保存',
    'confirmLinks.statusTitle': 'リンク確認ジョブのステータス',
    'confirmLinks.nonePending': '確認する新しいリンクはありません。次のステップで保存済みリンクを処理してください。',

    'searchParams.stepDesc': '検索パラメータ',
    'searchParams.tip': 'AIでプロンプトを分析し、構造化された検索パラメータを生成します（手動編集可）。',
    'searchParams.promptLabel': 'ハイレベルのプロンプト',
    'searchParams.promptPh': "例: 'Skyrim の主要/副次ロケーション'",
    'searchParams.generating': '生成中…',
    'searchParams.regen': 'パラメータを再生成',
    'searchParams.generate': '検索パラメータを生成',
    'searchParams.statusTitle': '生成ジョブのステータス',
    'searchParams.generatedPurpose': '生成された目的',
    'searchParams.generatedNotes': '生成された抽出ノート',
    'searchParams.generatedCriteria': '生成された基準',

    'entries.stepDesc': 'エントリ生成',
    'entries.addManualTitle': '手動リンクを追加',
    'entries.linksLabel': 'リンク',
    'entries.linksDesc': '1行につき1つのURL。',
    'entries.addNLinks': '{n}件のリンクを追加',
    'entries.noneToProcessTitle': '処理するリンクはありません',
    'entries.noneToProcessMsg': 'このプロジェクトのリンクはすべて処理済みです。',
    'entries.confirmGenTitle': '生成の確認',
    'entries.confirmGenMsg1': '{n}件の保留/失敗したリンクを処理します。',
    'entries.confirmGenMsg2': '{model} モデルに最大 {n} 回のAPI呼び出しが行われます。',
    'entries.startGen': '生成を開始',
    'entries.deleteSelectedTitle': '選択したリンクを削除',
    'entries.deleteSelectedMsg': '選択した {n} 件のリンクを削除しますか？',
    'entries.deleteLinks': 'リンクを削除',
    'entries.reprocessTitle': '選択したリンクを再処理',
    'entries.reprocessMsg': '{n} 件の選択したリンクを再処理します。',
    'entries.reprocess': '再処理',
    'entries.completePrev': '前のステップを完了してエントリを生成してください。',
    'entries.tip': '下でリンクを管理します。すべての保留/失敗リンクを処理するか、選択したリンクのみ再処理/削除できます。',
    'entries.startAll': 'すべてを生成',
    'entries.reprocessSel': '選択を再処理',
    'entries.deleteSel': '選択を削除',
    'entries.addManual': '手動リンクを追加',
    'entries.statusTitle': 'メイン生成ジョブのステータス',
    'entries.linkUrl': 'リンク URL',
    'entries.linksDeletedTitle': 'リンクを削除しました',
    'entries.linksDeletedMsg': '{n} 件のリンクを削除しました。',
    'entries.deleteFailed': 'リンクの削除に失敗しました',

    'jobs.statusTitle': 'ジョブ',
    'jobs.finished': 'ジョブが完了しました。ステータス',

    'completed.stepDesc': '確認とダウンロード',
  },
};

type I18nContextType = {
  lang: Lang;
  setLang: (l: Lang) => void;
  t: (key: string) => string;
};

console.log('[i18n] Creating context...');
const I18nContext = React.createContext<I18nContextType | null>(null);
console.log('[i18n] Context created:', I18nContext);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  console.log('[i18n] I18nProvider rendering...');
  const [lang, setLang] = React.useState<Lang>('en');

  React.useEffect(() => {
    const saved = localStorage.getItem('lang') as Lang | null;
    if (saved && (saved === 'en' || saved === 'zh' || saved === 'ja')) {
      setLang(saved);
      return;
    }
    // Detect from browser if not explicitly saved
    try {
      const pick = (s?: string | null): Lang => {
        const v = (s || '').toLowerCase();
        if (v.startsWith('zh')) return 'zh';
        if (v.startsWith('ja')) return 'ja';
        return 'en';
      };
      const nav = typeof navigator !== 'undefined' ? navigator : ({} as any);
      const langs: string[] = Array.isArray((nav as any).languages) ? (nav as any).languages : [];
      const chosen = langs.length > 0 ? pick(langs[0]) : pick((nav as any).language);
      setLang(chosen);
    } catch {
      setLang('en');
    }
  }, []);

  const t = React.useMemo(() => {
    const table = dicts[lang] || dicts.en;
    return (key: string) => table[key] ?? key;
  }, [lang]);

  const value = React.useMemo<I18nContextType>(() => ({
    lang,
    setLang: (l) => {
      localStorage.setItem('lang', l);
      setLang(l);
    },
    t,
  }), [lang, t]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

// Default fallback for when context is not available
const defaultI18n: I18nContextType = {
  lang: 'en',
  setLang: () => {},
  t: (key: string) => dicts.en[key] ?? key,
};

export function useI18n(): I18nContextType {
  console.log('[i18n] useI18n called');
  
  // Check if we're in a valid React context
  try {
    const ctx = React.useContext(I18nContext);
    console.log('[i18n] useI18n context result:', ctx ? 'found' : 'null');
    if (ctx) return ctx;
  } catch (e) {
    console.warn('[i18n] useI18n failed to get context:', e);
  }
  
  // Return default if context is not available
  console.warn('[i18n] useI18n returning default (no context)');
  return defaultI18n;
}
